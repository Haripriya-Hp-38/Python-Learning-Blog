import sounddevice as sd
import numpy as np
import librosa
import scipy.signal as signal

SAMPLE_RATE = 44100  
DURATION = 2 

def detect_clap(audio):
    energy = np.sum(audio ** 2)
    if energy > 0.25:  
        return True
    return False

def detect_whistle(audio):
   
    freqs, times, Sxx = signal.spectrogram(audio, SAMPLE_RATE)
    whistle_band = (freqs > 1000) & (freqs < 4000)
    whistle_energy = np.mean(Sxx[whistle_band, :])
    if whistle_energy > 1e-6:
        return True
    return False

print("Listening for sounds (Clap or Whistle)... Press Ctrl+C to stop.")

try:
    while True:
        audio = sd.rec(int(DURATION * SAMPLE_RATE), samplerate=SAMPLE_RATE, channels=1)
        sd.wait()
        audio = audio.flatten()

        if detect_clap(audio):
            print("Clap detected!")
        elif detect_whistle(audio):
            print("ðŸŽµ Whistle detected!")
        else:
            print("No event detected.")
except KeyboardInterrupt:
    print("Stopped by user.")
